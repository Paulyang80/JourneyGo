{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JourneyGo - Invite page</title>
    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;400;900&family=Ubuntu&display=swap" rel="stylesheet">
    <!-- Favicon and touch icons -->
    <link type="image/x-icon" href="images/favicon1.ico" rel="icon" />
    <link type="image/x-icon" href="images/favicon1.ico" rel="shortcut icon" />
    <link type="image/x-icon" href="images/favicon1.ico" rel="bookmark" />
    <!-- Favicon for Chrome -->
    <link rel="icon" type="image/png" sizes="192x192" href="/xxx/xxx.png" />
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <!-- Fontawesome -->
    <script src="https://kit.fontawesome.com/a973304abd.js" crossorigin="anonymous"></script>
    <!-- css -->
    {% comment %} <link href="{% static "css/style.css" %}" rel="stylesheet" type="text/css"> {% endcomment %}
    <link rel="stylesheet" href="{% static "css/navbar-styles.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "css/room.css" %}">
  </head>

  <body>
    <section id="title">

        <div class="container-fluid">

          <!-- Nav Bar -->
          <nav class="navbar navbar-expand-lg navbar-dark">
            <a class="navbar-brand" href="{% url 'index' %}">JourneyGo</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'index' %}"><i class="fa-solid fa-house"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'searchPage' %}"><i class="fa-solid fa-magnifying-glass"></i> Search</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'friends' %}"><i class="fa-solid fa-user-group"></i> My Friends</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'setting' %}"><i class="fa-solid fa-gear"></i> Settings</a>
                    </li>
                </ul>
            </div>
          </nav>
        </section>

        <div id="main">
            <div class="container px-4 px-lg-5">
              <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                  <h1>YOUR ROOM</h1>
                    <ul id="todo">Invited</ul>
                    <ul id="done">Friend List</ul>
                    <!--Next Step: Get FB Profile pic CDN-->
                    <script>
                        var done = "{{ friends_name | safe }}"; // use "safe" to convert &#x27; to quote
                        done = done.replace(/'/g, '"');         // convert string to array
                        done = JSON.parse(done);
                        //alert(done); 

                        var imgList = "{{ friends_pic | safe }}";
                        imgList = imgList.replace(/'/g, '"');
                        imgList = JSON.parse(imgList);
                        //alert(imgList)

                        var hashtag = "{{ friends_hash | safe }}";
                        hashtag = hashtag.replace(/'/g, '"');
                        hashtag = JSON.parse(hashtag);
                        //alert(hashtag);

                        const appendItem = (textContent,imgContent, hashContent, parentNodeId) => {
                            const newItem = document.createElement('li');
                            newItem.classList.add('todo_item');
                            // new
                            const img = document.createElement('img');
                            img.src=imgContent
                            img.width=100
                            // newItemImg.innerHTML = `<p class='todo_content'>${imgContent}</p>`
                            newItem.innerHTML = `<p class='todo_content'>${textContent}<br>Hashtag: #${hashContent}</p>`
                                                
                            // new
                            newItem.appendChild(img)

                            document.querySelector(`#${parentNodeId}`).appendChild(newItem);

                            // document.querySelector(`#${parentNodeId}`).appendChild(img);
                        };

                        const itemMove = (event, newParentNodeId) => {
                            const target = event.target;
                            console.log(target.parentNode.childNodes)
                            if (target.classList.contains('todo_content')) {
                                // done.unshift(target.textContent);
                                // todo = todo.filter(value => value !== target.textContent);

                                // new
                                const newItem = document.createElement('li');
                                newItem.classList.add('todo_item');
                                // alert(target.textContent);
                                newItem.innerHTML = `<p class='todo_content'>${target.textContent}</p>`
                                console.log(newItem)
                                newItem.appendChild(target.parentNode.childNodes[1])
                                document.querySelector(`#${newParentNodeId}`).appendChild(newItem);
                                target.parentNode.remove();

                                // appendItem(target.textContent,target.imgContent, newParentNodeId);
                            }
                        }

                        // render all todo items
                        for (var i = 0; i < done.length; i++) {
                            appendItem(done[i],imgList[i],hashtag[i], 'done');
                        }

                        // add event listener to parent node todo, then see whether the clicked element contains todo_content class
                        document.querySelector('#todo').addEventListener('click', function (event) {
                            itemMove(event, 'done');
                        });

                        document.querySelector('#done').addEventListener('click', function(event) {
                            itemMove(event, 'todo');
                        });
                    </script>
                    <!---->
                </div>
              </div>
            </div>
        </div>

          <div align="center">
            <button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#exampleModal">Go</button>
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <p>Ready to go?</p>
                    <a href="{% url 'spotvote' %}"><button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#exampleModal">Go</button></a>
                  </div>
                </div>
              </div>
            </div>
            <a href="{% url 'start' %}"><button type="button" class="btn btn-secondary btn-lg">Cancel</button></a>
          </div>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
          <!-- Core theme JS-->

  </body>


</html>
